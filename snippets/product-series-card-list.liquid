{% comment %} 11-12-25 {% endcomment %}
{% comment %} without order {% endcomment %}
{% comment %} {% liquid
  assign parent_title = collection.title
  assign all_collections = collections | sort: "title"

  comment
    Main device collections to exclude from subcollection listing
  endcomment
  assign main_models = "iPhone 17,iPhone 17 Pro,iPhone 17 Pro Max,iPhone 17 Air ,iPhone Air,iPhone 16 Pro Max,iPhone 16 Pro,iPhone 16 Plus,iPhone 16,iPhone 15 Pro Max,iPhone 15,iPhone 14 Pro Max,iPhone 14 Plus,iPhone 14 Pro,iPhone 14,Samsung S25 Ultra,Samsung S25 Plus,Samsung S25,Samsung S24 Ultra,Samsung S24 Plus,Samsung S24,Samsung S23 Ultra,Samsung S23 Plus,Samsung S23" | split: ","

  comment
    Words to remove from subcollection names
  endcomment
  assign excluded_words = "Pro,Max,Plus,Series,Air,Ultra" | split: ","

  comment
    Keep track of displayed subcollection names to avoid duplicates
  endcomment
  assign displayed_subcollections = ""
%}

<div class="series-collection-wrapper" id="series-collection-{{ section.id }}">
  {% assign found_collections = false %}

  {% for sub_collection in all_collections %}

    {%- comment -%}
      Skip if collection is a main device model
    {%- endcomment -%}
    {% if main_models contains sub_collection.title %}
      {% continue %}
    {% endif %}
    {% comment %} {{ sub_collection.title }} {% endcomment %}

    {%- comment -%}
      Only include collections starting with parent_title + space
    {%- endcomment -%}
    {% assign desired_prefix = parent_title | append: " " %}
    {% assign prefix_length = desired_prefix | size %}
    {% assign sub_prefix = sub_collection.title | slice: 0, prefix_length %}

    {% if sub_prefix == desired_prefix and sub_collection.title != parent_title %}

      {%- comment -%}
        Clean subcollection name:
        1. Remove parent title
        2. Remove words: Pro, Max, Plus
        3. Strip extra spaces
      {%- endcomment -%}
      {% assign cleaned_name = sub_collection.title | remove: parent_title | strip %}

      {% for word in excluded_words %}
        {% assign cleaned_name = cleaned_name | remove: word | strip %}
      {% endfor %}

      {%- comment -%}
        Skip duplicate subcollection names
      {%- endcomment -%}
      {% if displayed_subcollections contains cleaned_name %}
        {% continue %}
      {% endif %}

      {% assign displayed_subcollections = displayed_subcollections | append: cleaned_name | append: "," %}
      {% assign found_collections = true %}
      

      <div class="series-block">

        <!-- Display cleaned subcollection name -->
        <h2 class="series-heading text-center"
            style="margin:40px 0 20px;font-size:24px;font-weight:700;color:#e60000;">
          {{ cleaned_name }}
        </h2>

        <!-- Subcollection Product Grid -->
        {% paginate sub_collection.products by 8 %}
          <ul class="productGrid cst-new-grid column-4 list-unstyled flex flex-wrap justify-center gap-6">
            {% for product in sub_collection.products %}
              <li class="product w-full sm:w-1/2 md:w-1/3 lg:w-1/4">
                {% render 'product-grid-layout',
                  product_card_product: product,
                  complementary_product_button_atc: true,
                  serial: forloop.index,
                  sectionId: section.id,
                  show_list: false,
                  loading: true
                %}
              </li>
            {% endfor %}
          </ul>

          {% if paginate.pages > 1 %}
            <div class="pagination-wrapper text-center mt-4 mb-8">
              {% render 'pagination-listing',
                paginate: paginate,
                anchor: '',
                class: 'pagination-listing'
              %}
            </div>
          {% endif %}
        {% endpaginate %}

      </div>
    {% endif %}

  {% endfor %}

  {% unless found_collections %}
    <div class="text-center py-12">
      <p>No related subcollections found for {{ parent_title }}.</p>
    </div>
  {% endunless %}
</div> {% endcomment %}

{% comment %} 11-12-25 {% endcomment %}

{% comment %} {% liquid
  assign parent_title = collection.title
  assign all_collections = collections | sort: "title"

  comment
    Main device collections to exclude
  endcomment
  assign main_models = "iPhone 17,iPhone 17 Pro,iPhone 17 Pro Max,iPhone 17 Air,iPhone Air,iPhone 16 Pro Max,iPhone 16 Pro,iPhone 16 Plus,iPhone 16,iPhone 15 Pro Max,iPhone 15,iPhone 14 Pro Max,iPhone 14 Plus,iPhone 14 Pro,iPhone 14,Samsung S25 Ultra,Samsung S25 Plus,Samsung S25,Samsung S24 Ultra,Samsung S24 Plus,Samsung S24,Samsung S23 Ultra,Samsung S23 Plus,Samsung S23" | split: ","

  comment
    Fixed display order for case types (MUST be single line)
  endcomment
  assign ordered_case_types = "Highline Crystal Clear Case,Highline Fushion Matte Case,Impact Shield Case,Explorer Flex Case,Raptor Fusion Case,Pegasus Case,Orion cases,Defender cases" | split: ","
%}

<div class="series-collection-wrapper" id="series-collection-{{ section.id }}">
  {% assign found_collections = false %}

  {% for case_name in ordered_case_types %}
    {% assign case_name = case_name | strip %}

    {% for sub_collection in all_collections %}

      {%- comment -%} Skip main models {%- endcomment -%}
      {% if main_models contains sub_collection.title %}
        {% continue %}
      {% endif %}

      {%- comment -%} Must belong to parent collection {%- endcomment -%}
      {% assign desired_prefix = parent_title | append: " " %}
      {% assign prefix_length = desired_prefix | size %}
      {% assign sub_prefix = sub_collection.title | slice: 0, prefix_length %}

      {% if sub_prefix == desired_prefix %}

        {%- comment -%} Extract subcollection name {%- endcomment -%}
        {% assign cleaned_name = sub_collection.title | remove: parent_title | strip %}

        {% if cleaned_name == case_name %}
          {% assign found_collections = true %}

          <div class="series-block">

            <h2 class="series-heading text-center"
                style="margin:40px 0 20px;font-size:24px;font-weight:700;color:#e60000;">
              {{ cleaned_name }}
            </h2>

            {% paginate sub_collection.products by 8 %}
              <ul class="productGrid cst-new-grid column-4 list-unstyled flex flex-wrap justify-center gap-6">
                {% for product in sub_collection.products %}
                  <li class="product w-full sm:w-1/2 md:w-1/3 lg:w-1/4">
                    {% render 'product-grid-layout',
                      product_card_product: product,
                      complementary_product_button_atc: true,
                      serial: forloop.index,
                      sectionId: section.id,
                      show_list: false,
                      loading: true
                    %}
                  </li>
                {% endfor %}
              </ul>

              {% if paginate.pages > 1 %}
                <div class="pagination-wrapper text-center mt-4 mb-8">
                  {% render 'pagination-listing',
                    paginate: paginate,
                    anchor: '',
                    class: 'pagination-listing'
                  %}
                </div>
              {% endif %}
            {% endpaginate %}

          </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endfor %}

  {% unless found_collections %}
    <div class="text-center py-12">
      <p>No related subcollections found for {{ parent_title }}.</p>
    </div>
  {% endunless %}
</div>  {% endcomment %}
{% liquid
  assign parent_title = collection.title
  assign all_collections = collections | sort: "title"

  assign main_models = "iPhone 17,iPhone 17 Pro,iPhone 17 Pro Max,iPhone 17 Air,iPhone Air,iPhone 16 Pro Max,iPhone 16 Pro,iPhone 16 Plus,iPhone 16,iPhone 15 Pro Max,iPhone 15,iPhone 14 Pro Max,iPhone 14 Plus,iPhone 14 Pro,iPhone 14,Samsung S25 Ultra,Samsung S25 Plus,Samsung S25,Samsung S24 Ultra,Samsung S24 Plus,Samsung S24,Samsung S23 Ultra,Samsung S23 Plus,Samsung S23" | split: ","

  assign ordered_case_types = "Highline Crystal Clear Case,Highline Fushion Matte Case,Impact Shield Case,Explorer Flex Case,Raptor Fusion Case,Pegasus Case,Orion cases,Defender cases" | split: ","
%}

<div class="series-collection-wrapper" id="series-collection-{{ section.id }}">
  {% assign found_collections = false %}

  {% for case_name in ordered_case_types %}
    {% assign case_name = case_name | strip %}

    {% for sub_collection in all_collections %}

      {% if main_models contains sub_collection.title %}
        {% continue %}
      {% endif %}

      {% assign desired_prefix = parent_title | append: " " %}
      {% assign prefix_length = desired_prefix | size %}
      {% assign sub_prefix = sub_collection.title | slice: 0, prefix_length %}

      {% if sub_prefix == desired_prefix %}

        {% assign cleaned_name = sub_collection.title | remove: parent_title | strip %}

        {% if cleaned_name == case_name and sub_collection.products_count > 0 %}
          {% assign found_collections = true %}

          <div class="series-block">

            <h2 class="series-heading text-center"
                style="margin:40px 0 20px;font-size:24px;font-weight:700;color:#e60000;">
              {{ cleaned_name }}
            </h2>

            {% paginate sub_collection.products by 8 %}
              <ul class="productGrid cst-new-grid column-4 list-unstyled flex flex-wrap justify-center gap-6">
                {% for product in sub_collection.products %}
                  <li class="product w-full sm:w-1/2 md:w-1/3 lg:w-1/4">
                    {% render 'product-grid-layout',
                      product_card_product: product,
                      complementary_product_button_atc: true,
                      serial: forloop.index,
                      sectionId: section.id,
                      show_list: false,
                      loading: true
                    %}
                  </li>
                {% endfor %}
              </ul>
            {% endpaginate %}

          </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endfor %}

  {% unless found_collections %}
    <div class="text-center py-12">
      <p>No related subcollections found for {{ parent_title }}.</p>
    </div>
  {% endunless %}
</div>
